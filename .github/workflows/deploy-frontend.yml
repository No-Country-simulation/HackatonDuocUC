name: Build and deploy to Netlify

on:
  workflow_run:
    workflows: ["Deploy Backend to AWS EC2"]
    types:
      - completed
  workflow_dispatch:  # Permite ejecuci√≥n manual

jobs:
  deploy-frontend:
      runs-on: ubuntu-latest
      # SOLO se ejecuta si el backend fue exitoso
      if: ${{ github.event.workflow_run.conclusion == 'success' }}

      steps:
          - name: Checkout repository
            uses: actions/checkout@v4

          - name: Set up Node.js environment
            uses: actions/setup-node@v4
            with:
                node-version: 20
                cache: "npm"

          - name: Install project dependencies
            run: |
              cd FRONTEND
              npm install

          - name: Build the project
            run: |
              cd FRONTEND
              npm run build

          - name: Deploy to Netlify
            run: npx netlify deploy --prod --dir=dist --site=$NETLIFY_SITE_ID
            env:
                NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
                NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
